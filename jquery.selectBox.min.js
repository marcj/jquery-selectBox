/**
 * jQuery SelectBox
 *
 * v1.2.0
 * github.com/marcj/jquery-selectBox
 */
(function(e){function t(e,t){if(e instanceof jQuery)if(0<e.length)e=e[0];else return;this.I=null;this.k="";this.G=navigator.platform.match(/mac/i);t="object"===typeof t?t:{};this.c=e;if(!t.aa&&navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i)||"select"!==e.tagName.toLowerCase())return!1;this.M(t)}t.prototype.M=function(t){var n=e(this.c);if(!n.data("selectBox-control")){var r=e('<a class="selectBox" />'),i=n.a("multiple")||1<parseInt(n.a("size")),s=t||{},o=parseInt(n.H("tabindex"))||0,u=this;r.width(n.outerWidth()).d(n.a("class")).a("title",n.a("title")||"").a("tabindex",o).g("display","inline-block");e(window).data("selectBox-bindings")||e(window).data("selectBox-bindings",!0);n.a("disabled")&&r.d("selectBox-disabled");if(i){if(t=this.s("inline"),r.append(t).data("selectBox-options",t).d("selectBox-inline selectBox-menuShowing").bind("keydown.selectBox",function(e){u.C(e)}).bind("keypress.selectBox",function(e){u.D(e)}).bind("mousedown.selectBox",function(t){1===t.which&&(e(t.target).O("A.selectBox-inline")&&t.preventDefault(),r.b("selectBox-focus")||r.focus())}).N(n),!n[0].style.height){i=n.a("size")?parseInt(n.a("size")):5;o=r.X().ca("id").g({position:"absolute",top:"-9999em"}).show().w("body");o.find(".selectBox-options").t("<li><a> </a></li>");var a=parseInt(o.find(".selectBox-options A:first").t(" ").outerHeight());o.remove();r.height(a*i)}}else i=e('<span class="selectBox-label" />'),o=e('<span class="selectBox-arrow" />'),i.a("class",this.A()).text(this.B()),t=this.s("dropdown"),t.w("BODY"),r.data("selectBox-options",t).d("selectBox-dropdown").append(i).append(o).bind("mousedown.selectBox",function(e){1===e.which&&(r.b("selectBox-menuShowing")?u.l():(e.stopPropagation(),t.data("selectBox-down-at-x",e.screenX).data("selectBox-down-at-y",e.screenY),u.i()))}).bind("keydown.selectBox",function(e){u.C(e)}).bind("keypress.selectBox",function(e){u.D(e)}).bind("open.selectBox",function(e,t){t&&!0===t.m||u.i()}).bind("close.selectBox",function(e,t){t&&!0===t.m||u.l()}).N(n),o=r.width()-o.outerWidth()-(parseInt(i.g("paddingLeft"))||0)-(parseInt(i.g("paddingRight"))||0),i.width(o);this.r(r);n.d("selectBox").data("selectBox-control",r).data("selectBox-settings",s).F()}};t.prototype.s=function(t){function n(t,r){t.children("OPTION, OPTGROUP").e(function(){if(e(this).O("OPTION"))0<e(this).length?i.L(e(this),r):r.append("<li> </li>");else{var t=e('<li class="selectBox-optgroup" />');t.text(e(this).a("label"));r.append(t);r=n(e(this),r)}});return r}var r=e(this.c),i=this;switch(t){case"inline":return t=e('<ul class="selectBox-options" />'),t=n(r,t),t.find("A"),this.r(t),t;case"dropdown":t=e('<ul class="selectBox-dropdown-menu selectBox-options" />');t=n(r,t);t.data("selectBox-select",r).g("display","none").w("BODY").find("A");r=r.a("class")||"";if(""!==r){var r=r.split(" "),s;for(s in r)t.d(r[s]+"-selectBox-dropdown-menu")}this.r(t);return t}};t.prototype.A=function(){return("selectBox-label "+(e(this.c).find("OPTION:selected").a("class")||"")).replace(/\s+$/,"")};t.prototype.B=function(){return e(this.c).find("OPTION:selected").text()||" "};t.prototype.u=function(){var t=e(this.c).data("selectBox-control");t&&t.find(".selectBox-label").a("class",this.A()).text(this.B())};t.prototype.K=function(){var t=e(this.c),n=t.data("selectBox-control");n&&(n.data("selectBox-options").remove(),n.remove(),t.f("selectBox").S("selectBox-control").data("selectBox-control",null).S("selectBox-settings").data("selectBox-settings",null).show())};t.prototype.refresh=function(){var t=e(this.c).data("selectBox-control"),n=t.b("selectBox-dropdown")?"dropdown":"inline",r;t.data("selectBox-options").remove();r=this.s(n);t.data("selectBox-options",r);switch(n){case"inline":t.append(r);break;case"dropdown":this.u(),e("BODY").append(r)}"dropdown"===n&&t.b("selectBox-menuShowing")&&this.i()};t.prototype.i=function(){var t=e(this.c),n=t.data("selectBox-control"),r=t.data("selectBox-settings"),i=n.data("selectBox-options");if(!n.b("selectBox-disabled")){this.l();var s=parseInt(n.g("borderBottomWidth"))||0,o=parseInt(n.g("borderTopWidth"))||0,u=n.offset().top+n.outerHeight()-s,u=(s=u+i.outerHeight()>e(window).outerHeight())?n.offset().top-i.outerHeight()+o:u;i.data("posTop",s);i.width(n.innerWidth()).g({top:u,left:n.offset().left}).d("selectBox-options-"+(s?"top":"bottom"));if(!t.q("beforeopen")){o=function(){t.q("open",{m:!0})};switch(r.Q){case"fade":i.Y(r.h,o);break;case"slide":i.ea(r.h,o);break;default:i.show(r.h,o)}r.h||o();r=i.find(".selectBox-selected:first");this.o(r,!0);this.n(r);n.d("selectBox-menuShowing-"+(s?"top":"bottom"));e(document)}}};t.prototype.l=function(){0!==e(".selectBox-dropdown-menu:visible").length&&(e(document).ha("mousedown.selectBox"),e(".selectBox-dropdown-menu").e(function(){function t(){r.q("close",{m:!0})}var n=e(this),r=n.data("selectBox-select"),i=r.data("selectBox-control"),s=r.data("selectBox-settings"),o=n.data("posTop");if(r.q("beforeclose"))return!1;if(s){switch(s.Q){case"fade":n.Z(s.h,t);break;case"slide":n.fa(s.h,t);break;default:n.F(s.h,t)}s.h||t();i.f("selectBox-menuShowing-"+(o?"top":"bottom"))}else e(this).F(),e(this).q("close",{m:!0}),e(this).f("selectBox-menuShowing-"+(o?"top":"bottom"));n.f("selectBox-options-"+(o?"top":"bottom"))}))};t.prototype.p=function(t,n){var r=e(this.c);t=e(t);var i=r.data("selectBox-control");r.data("selectBox-settings");if(!i.b("selectBox-disabled")&&0!==t.length&&!t.b("selectBox-disabled")){if(r.a("multiple"))if(n.shiftKey&&i.data("selectBox-last-selected")){t.W("selectBox-selected");var s;s=t.index()>i.data("selectBox-last-selected").index()?t.v().slice(i.data("selectBox-last-selected").index(),t.index()):t.v().slice(t.index(),i.data("selectBox-last-selected").index());s=s.ba(".selectBox-optgroup, .selectBox-disabled");t.b("selectBox-selected")?s.d("selectBox-selected"):s.f("selectBox-selected")}else this.G&&n.metaKey||!this.G&&n.ctrlKey?t.W("selectBox-selected"):(t.v().f("selectBox-selected"),t.d("selectBox-selected"));else t.v().f("selectBox-selected"),t.d("selectBox-selected");i.b("selectBox-dropdown")&&i.find(".selectBox-label").text(t.text());var o=0,u=[];r.a("multiple")?i.find(".selectBox-selected A").e(function(){u[o++]=e(this).a("rel")}):u=t.find("A").a("rel");i.data("selectBox-last-selected",t);r.j()!==u&&(r.j(u),this.u(),r.ga("change"))}};t.prototype.n=function(t){t=e(t);e(this.c).data("selectBox-control").data("selectBox-options").find(".selectBox-hover").f("selectBox-hover");t.d("selectBox-hover")};t.prototype.T=function(){e(void 0);e(this.c).data("selectBox-control").data("selectBox-options").find(".selectBox-hover").f("selectBox-hover")};t.prototype.o=function(t,n){if(t&&0!==t.length){var r=e(this.c).data("selectBox-control"),i=r.data("selectBox-options"),r=r.b("selectBox-dropdown")?i:i.parent(),i=parseInt(t.offset().top-r.position().top),s=parseInt(i+t.outerHeight());n?r.scrollTop(t.offset().top-r.offset().top+r.scrollTop()-r.height()/2):(0>i&&r.scrollTop(t.offset().top-r.offset().top+r.scrollTop()),s>r.height()&&r.scrollTop(t.offset().top+t.outerHeight()-r.offset().top+r.scrollTop()-r.height()))}};t.prototype.C=function(t){var n=e(this.c),r=n.data("selectBox-control"),i=r.data("selectBox-options"),n=n.data("selectBox-settings"),s=0,o=0;if(!r.b("selectBox-disabled"))switch(t.keyCode){case 8:t.preventDefault();this.k="";break;case 9:case 27:this.l();this.T();break;case 13:r.b("selectBox-menuShowing")?(this.p(i.find("LI.selectBox-hover:first"),t),r.b("selectBox-dropdown")&&this.l()):this.i();break;case 38:case 37:t.preventDefault();if(r.b("selectBox-menuShowing")){r=i.find(".selectBox-hover").R("LI");s=i.find("LI:not(.selectBox-optgroup)").length;for(o=0;(0===r.length||r.b("selectBox-disabled")||r.b("selectBox-optgroup"))&&!(r=r.R("LI"),0===r.length&&(r=n.P?i.find("LI:last"):i.find("LI:first")),++o>=s););this.n(r);this.p(r,t);this.o(r)}else this.i();break;case 40:case 39:if(t.preventDefault(),r.b("selectBox-menuShowing")){r=i.find(".selectBox-hover").next("LI");s=i.find("LI:not(.selectBox-optgroup)").length;for(o=0;(0===r.length||r.b("selectBox-disabled")||r.b("selectBox-optgroup"))&&!(r=r.next("LI"),0===r.length&&(r=n.P?i.find("LI:first"):i.find("LI:last")),++o>=s););this.n(r);this.p(r,t);this.o(r)}else this.i()}};t.prototype.D=function(t){var n=e(this.c).data("selectBox-control"),r=n.data("selectBox-options"),i=this;if(!n.b("selectBox-disabled"))switch(t.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:n.b("selectBox-menuShowing")||this.i(),t.preventDefault(),clearTimeout(this.I),this.k+=String.fromCharCode(t.charCode||t.keyCode),r.find("A").e(function(){if(e(this).text().substr(0,i.k.length).toLowerCase()===i.k.toLowerCase())return i.n(e(this).parent()),i.p(e(this).parent(),t),i.o(e(this).parent()),!1}),this.I=setTimeout(function(){i.k=""},1e3)}};t.prototype.enable=function(){var t=e(this.c);t.H("disabled",!1);(t=t.data("selectBox-control"))&&t.f("selectBox-disabled")};t.prototype.disable=function(){var t=e(this.c);t.H("disabled",!0);(t=t.data("selectBox-control"))&&t.d("selectBox-disabled")};t.prototype.V=function(t){var n=e(this.c);n.j(t);t=n.j();null===t&&(t=n.children().first().j(),n.j(t));var r=n.data("selectBox-control");if(r){var i=n.data("selectBox-settings"),r=r.data("selectBox-options");this.u();r.find(".selectBox-selected").f("selectBox-selected");r.find("A").e(function(){if("object"===typeof t)for(var n=0;n<t.length;n++)e(this).a("rel")==t[n]&&e(this).parent().d("selectBox-selected");else e(this).a("rel")==t&&e(this).parent().d("selectBox-selected")});i.J&&i.J.call(n)}};t.prototype.U=function(t){var n=e(this.c),r=n.data("selectBox-control");switch(typeof t){case"string":n.t(t);break;case"object":n.t("");for(var i in t)if(null!==t[i]){if("object"===typeof t[i]){var s=e('<optgroup label="'+i+'" />'),o;for(o in t[i])s.append('<option value="'+o+'">'+t[i][o]+"</option>")}else s=e('<option value="'+i+'">'+t[i]+"</option>");n.append(s)}}r&&this.refresh()};t.prototype.r=function(t){e(t).g("MozUserSelect","none")};t.prototype.L=function(t,n){var r=e("<li />"),i=e("<a />");r.d(t.a("class"));r.data(t.data());i.a("rel",t.j()).text(t.text());r.append(i);t.a("disabled")&&r.d("selectBox-disabled");t.a("selected")&&r.d("selectBox-selected");n.append(r)};e.extend(e.$,{da:function(n,r){var i;switch(n){case"control":return e(this).data("selectBox-control");case"settings":if(!r)return e(this).data("selectBox-settings");e(this).e(function(){e(this).data("selectBox-settings",e.extend(!0,e(this).data("selectBox-settings"),r))});break;case"options":if(void 0===r)return e(this).data("selectBox-control").data("selectBox-options");e(this).e(function(){(i=e(this).data("selectBox"))&&i.U(r)});break;case"value":if(void 0===r)return e(this).j();e(this).e(function(){(i=e(this).data("selectBox"))&&i.V(r)});break;case"refresh":e(this).e(function(){(i=e(this).data("selectBox"))&&i.refresh()});break;case"enable":e(this).e(function(){(i=e(this).data("selectBox"))&&i.enable(this)});break;case"disable":e(this).e(function(){(i=e(this).data("selectBox"))&&i.disable()});break;case"destroy":e(this).e(function(){if(i=e(this).data("selectBox"))i.K(),e(this).data("selectBox",null)});break;case"instance":return e(this).data("selectBox");default:e(this).e(function(r,i){e(i).data("selectBox")||e(i).data("selectBox",new t(i,n))})}return e(this)}})})(jQuery)
